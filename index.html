<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<title>CEO Dashboard</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0" />

<style>
body {
    margin: 0;
    font-family: -apple-system, BlinkMacSystemFont, "Apple SD Gothic Neo", sans-serif;
    background: #ffffff;
    color: #111;
}

.container {
    max-width: 1200px;
    margin: 40px auto;
    padding: 0 20px;
}

header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    border-bottom: 1px solid #e5e5e5;
    padding-bottom: 16px;
    margin-bottom: 24px;
}

header h1 {
    font-size: 18px;
    font-weight: 600;
}

header span {
    font-size: 14px;
    color: #666;
}

.grid {
    display: grid;
    grid-template-columns: 1fr 2fr 1fr;
    gap: 24px;
}

.section {
    border: 1px solid #eaeaea;
    padding: 16px;
}

.section h2 {
    font-size: 14px;
    font-weight: 600;
    margin-bottom: 12px;
}

.list, .news {
    font-size: 13px;
    line-height: 1.6;
}

input[type="text"] {
    width: 100%;
    border: none;
    border-bottom: 1px solid #ddd;
    padding: 6px 0;
    font-size: 13px;
    margin-bottom: 8px;
}

input[type="checkbox"] {
    margin-right: 8px;
}

.todo-item {
    display: flex;
    align-items: center;
    margin-bottom: 6px;
}

.calendar {
    margin-top: 24px;
}

footer {
    margin-top: 24px;
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 24px;
}

small {
    color: #999;
}
    #lockScreen {
  position: fixed;
  inset: 0;
  background: #fff;
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 9999;
}

.lock-box {
  text-align: center;
  border: 1px solid #e5e5e5;
  padding: 40px;
}

.lock-box h2 {
  margin-bottom: 20px;
  font-size: 18px;
}

.lock-box input {
  width: 160px;
  padding: 8px;
  font-size: 14px;
  text-align: center;
  margin-bottom: 12px;
}

.lock-box button {
  padding: 6px 14px;
  font-size: 13px;
  cursor: pointer;
}
 .mail-group {
  margin-bottom: 16px;
}

.mail-group h3 {
  font-size: 13px;
  font-weight: 600;
  margin-bottom: 6px;
  color: #333;
}
</style>
</head>

<body>
    <div id="lockScreen">
  <div class="lock-box">
    <h2>CEO Dashboard</h2>
    <input type="password" id="pinInput" placeholder="PIN 입력" />
    <button onclick="unlock()">확인</button>
  </div>
</div>
<div class="container">

<header>
    <h1>CEO Dashboard</h1>
    <span id="today"></span>
</header>

<div class="grid">

    <!-- MAIL -->
<div class="section">
  <h2>MAIL</h2>

  <div class="mail-group">
    <h3>Gmail · 개인</h3>
    <div id="mail_gmail_personal">불러오는 중…</div>
  </div>

  <div class="mail-group">
    <h3>Gmail · 회사</h3>
    <div id="mail_gmail_company">불러오는 중…</div>
  </div>

  <div class="mail-group">
    <h3>네이버 · 개인</h3>
    <div id="mail_naver_personal">불러오는 중…</div>
  </div>

  <div class="mail-group">
    <h3>네이버 · 회사</h3>
    <div id="mail_naver_company">불러오는 중…</div>
  </div>
</div>

    <!-- TODAY TASKS -->
<div class="section">
  <h2>TODAY TASKS</h2>
  <div id="todayTasks"></div>
  <input type="text" id="newTodayTask" placeholder="업무 추가 후 Enter" />
</div>

    <!-- YESTERDAY -->
<div class="section">
  <h2>YESTERDAY</h2>
  <div id="yesterdayTasks" class="list"></div>
</div>

<!-- CALENDAR -->
<div class="section calendar">
    <h2>CALENDAR</h2>
    <div class="list">
        09:00 내부 미팅<br/>
        13:00 외부 미팅<br/>
        16:30 전화 미팅
    </div>
</div>

<footer>

    <!-- CHECK LIST -->
<div class="section">
  <h2>CHECK LIST</h2>
  <div id="checkList"></div>
  <input type="text" id="newCheckItem" placeholder="체크 항목 추가 후 Enter" />
</div>

    <!-- NEWS -->
    <div class="section">
        <h2>ECONOMIC NEWS</h2>
        <div class="news">
            • 미 연준 금리 동결<br/>
            • 원·달러 환율 변동<br/>
            • 글로벌 증시 혼조
        </div>
    </div>

</footer>

<small>Private · CEO Only</small>

</div>

<script>
/* =====================
   GLOBAL
===================== */
const PIN_CODE = '0925';
const MAIL_API = 'https://script.google.com/macros/s/AKfycbyXlpoE7c6MGH-uZEbwsTzoEVZf_GNBvJ6e-gSRBk_uazd16TIDpgDqS6uamBQ5XAQ/exec';

/* =====================
   PIN UNLOCK (전역)
===================== */
function unlock() {
  const input = document.getElementById('pinInput').value;
  if (input === PIN_CODE) {
    localStorage.setItem('ceo_unlocked', 'true');
    document.getElementById('lockScreen').style.display = 'none';
  } else {
    alert('PIN이 틀렸습니다.');
  }
}

/* =====================
   MAIN
===================== */
document.addEventListener('DOMContentLoaded', () => {

  /* PIN 상태 확인 */
  if (localStorage.getItem('ceo_unlocked') === 'true') {
    document.getElementById('lockScreen').style.display = 'none';
  }

  /* 오늘 날짜 */
  const todayISO = new Date().toISOString().slice(0, 10);
  document.getElementById('today').innerText =
    new Date().toLocaleDateString('ko-KR', {
      year: 'numeric',
      month: '2-digit',
      day: '2-digit',
      weekday: 'short'
    });

  /* =====================
     TODO / CHECK 공통
  ===================== */
  function renderList(key, containerId) {
    const container = document.getElementById(containerId);
    container.innerHTML = '';
    const items = JSON.parse(localStorage.getItem(key) || '[]');

    items.forEach((item, index) => {
      const row = document.createElement('div');
      row.className = 'todo-item';

      const checkbox = document.createElement('input');
      checkbox.type = 'checkbox';
      checkbox.checked = item.done;

      checkbox.onchange = () => {
        items[index].done = checkbox.checked;
        localStorage.setItem(key, JSON.stringify(items));
      };

      const text = document.createElement('span');
      text.textContent = item.text;
      if (item.done) text.style.color = '#aaa';

      const del = document.createElement('span');
      del.textContent = ' ×';
      del.style.cursor = 'pointer';
      del.style.color = '#ccc';
      del.onclick = () => {
        items.splice(index, 1);
        localStorage.setItem(key, JSON.stringify(items));
        renderList(key, containerId);
      };

      row.appendChild(checkbox);
      row.appendChild(text);
      row.appendChild(del);
      container.appendChild(row);
    });
  }

  /* TODAY TASKS */
  const todayKey = 'todayTasks_' + todayISO;
  renderList(todayKey, 'todayTasks');

  document.getElementById('newTodayTask').addEventListener('keypress', e => {
    if (e.key === 'Enter' && e.target.value.trim()) {
      const items = JSON.parse(localStorage.getItem(todayKey) || '[]');
      items.push({ text: e.target.value, done: false });
      localStorage.setItem(todayKey, JSON.stringify(items));
      e.target.value = '';
      renderList(todayKey, 'todayTasks');
    }
  });

  /* CHECK LIST */
  const checkKey = 'checkList';
  renderList(checkKey, 'checkList');

  document.getElementById('newCheckItem').addEventListener('keypress', e => {
    if (e.key === 'Enter' && e.target.value.trim()) {
      const items = JSON.parse(localStorage.getItem(checkKey) || '[]');
      items.push({ text: e.target.value, done: false });
      localStorage.setItem(checkKey, JSON.stringify(items));
      e.target.value = '';
      renderList(checkKey, 'checkList');
    }
  });

  /* YESTERDAY */
  const yesterday = new Date();
  yesterday.setDate(yesterday.getDate() - 1);
  const yesterdayKey = 'todayTasks_' + yesterday.toISOString().slice(0, 10);
  const yesterdayData = JSON.parse(localStorage.getItem(yesterdayKey) || '[]');
  const yBox = document.getElementById('yesterdayTasks');

  yBox.innerHTML = '';
  if (yesterdayData.length === 0) {
    yBox.textContent = '• 기록 없음';
  } else {
    yesterdayData.forEach(item => {
      const row = document.createElement('div');
      row.textContent = '• ' + item.text;
      yBox.appendChild(row);
    });
  }

/* =====================
   MAIL LOAD (ACCOUNT BASED)
===================== */

const MAIL_APIS = {
  gmail_personal: {
    url: 'https://script.google.com/macros/s/AKfycbxPt7-RQromTNCVGjk1KW9UIf9hj6voRQEjJrlmZNy_oA3CHI03apedJWrDCbvpUU9njg/exec',
    target: 'mail_gmail_personal'
  },
  gmail_company: {
    url: 'https://script.google.com/macros/s/AKfycbyXlpoE7c6MGH-uzEBwsTzoEVZf_GNBvJGe-gSRBk_uaZdl6TIDpglDqS6uamBQ5XAQ/exec',
    target: 'mail_gmail_company'
  }
};

function renderMail(api) {
  const box = document.getElementById(api.target);
  box.textContent = '불러오는 중…';

  fetch(api.url)
    .then(res => res.json())
    .then(data => {
      box.innerHTML = '';

      if (!data || data.length === 0) {
        box.textContent = '읽지 않은 메일 없음';
        return;
      }

      data.slice(0, 6).forEach(mail => {
        const from = mail.from.split('<')[0].replace(/"/g, '').trim();
        const subject =
          mail.subject.length > 36
            ? mail.subject.slice(0, 36) + '…'
            : mail.subject;

        const row = document.createElement('div');
        row.style.marginBottom = '8px';
         const row = document.createElement('div');
        row.style.marginBottom = '8px';

        /* 발신자 + NAVER 라벨 */
        const strong = document.createElement('strong');
        strong.innerHTML = fromName + naverLabel;

        /* 줄바꿈 */
        const br = document.createElement('br');

    /* 메일 제목 링크 */
        const link = document.createElement('a');
        link.href = mail.link;
        link.target = '_blank';
        link.style.color = '#555';
        link.style.textDecoration = 'none';
        link.textContent = subject;

        /* 조립 */
        row.appendChild(strong);
        row.appendChild(br);
        row.appendChild(link);

        box.appendChild(row);
      });
    })
    .catch(() => {
      box.textContent = '메일 로드 실패';
    });
}

/* PIN 해제 이후에만 메일 로드 */
if (localStorage.getItem('ceo_unlocked') === 'true') {
  renderMail(MAIL_APIS.gmail_personal);
  renderMail(MAIL_APIS.gmail_company);
    }
});
</script>
</body>
</html>
