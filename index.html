<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<title>CEO Dashboard</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0" />

<style>
/* =====================
   BASE
===================== */
body {
  margin: 0;
  font-family: -apple-system, BlinkMacSystemFont, "Apple SD Gothic Neo", sans-serif;
  background: #ffffff;
  color: #111;
}

.container {
  max-width: 1200px;
  margin: 40px auto;
  padding: 0 20px;
}

header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  border-bottom: 1px solid #e5e5e5;
  padding-bottom: 16px;
  margin-bottom: 24px;
}

header h1 {
  font-size: 18px;
  font-weight: 600;
}

header span {
  font-size: 14px;
  color: #666;
}

.section {
  border: 1px solid #eaeaea;
  padding: 16px;
  box-sizing: border-box;
}

.section h2 {
  font-size: 14px;
  font-weight: 600;
  margin-bottom: 12px;
}

/* =====================
   MAIL MATRIX
===================== */
.mail-section {
  margin-bottom: 40px;
}

.mail-matrix {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 24px;
}

.mail-box {
  border: 1px solid #e5e5e5;
  padding: 12px 14px;
  min-height: 220px;
  display: flex;
  flex-direction: column;
}

.mail-box h3 {
  font-size: 13px;
  font-weight: 600;
  margin-bottom: 8px;
}

.mail-list {
  font-size: 13px;
  line-height: 1.6;
  overflow-y: auto;
  flex: 1;
}

/* =====================
   DASHBOARD GRID (핵심)
===================== */
.dashboard-grid {
  display: grid;
  grid-template-columns: 1.1fr 1.6fr 1.1fr;
  grid-template-areas:
    "today checklist yesterday"
    "news  news      calendar";
  gap: 24px;
}

/* 영역 매핑 */
.today { grid-area: today; }
.checklist { grid-area: checklist; }
.yesterday { grid-area: yesterday; }
.news { grid-area: news; }
.calendar-box { grid-area: calendar; }

/* 높이 기준 */
.today, .news { min-height: 300px; }
.checklist { min-height: 520px; }
.yesterday { min-height: 240px; }
.calendar-box { min-height: 300px; }

/* =====================
   NEWS
===================== */
.news-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 6px;
}

.news-header button {
  font-size: 12px;
  padding: 4px 10px;
  border: 1px solid #ddd;
  background: #fff;
  cursor: pointer;
}

.news-meta {
  font-size: 11px;
  color: #999;
  margin-bottom: 10px;
}

/* =====================
   MOBILE
===================== */
@media (max-width: 768px) {
  .container {
    margin: 20px auto;
    padding: 0 12px;
  }

  .mail-matrix {
    grid-template-columns: 1fr;
  }

  .dashboard-grid {
    grid-template-columns: 1fr;
    grid-template-areas:
      "today"
      "checklist"
      "yesterday"
      "calendar"
      "news";
  }

  header {
    flex-direction: column;
    align-items: flex-start;
    gap: 6px;
  }
}
</style>
</head>

<body>
<div class="container">

<header>
  <h1>CEO Dashboard</h1>
  <span id="today"></span>
</header>

<!-- MAIL -->
<div class="section mail-section">
  <h2>MAIL</h2>
  <div class="mail-matrix">
    <div class="mail-box">
      <h3>업무 지메일</h3>
      <div id="mail_gmail_company" class="mail-list"></div>
    </div>
    <div class="mail-box">
      <h3>개인 지메일</h3>
      <div id="mail_gmail_personal" class="mail-list"></div>
    </div>
    <div class="mail-box">
      <h3>업무 네이버</h3>
      <div id="mail_naver_company" class="mail-list">
        <small>지메일 전달 예정</small>
      </div>
    </div>
    <div class="mail-box">
      <h3>개인 네이버</h3>
      <div id="mail_naver_personal" class="mail-list">
        <small>지메일 전달 예정</small>
      </div>
    </div>
  </div>
</div>

<!-- DASHBOARD -->
<div class="dashboard-grid">

  <div class="section today">
    <h2>TODAY TASKS</h2>
    <div id="todayTasks"></div>
    <input type="text" id="newTodayTask" placeholder="업무 추가 후 Enter" />
  </div>

  <div class="section checklist">
    <h2>CHECK LIST</h2>
    <div id="checkList"></div>
    <input type="text" id="newCheckItem" placeholder="체크 항목 추가 후 Enter" />
  </div>

  <div class="section yesterday">
    <h2>YESTERDAY</h2>
    <div id="yesterdayTasks"></div>
  </div>

  <div class="section news">
    <div class="news-header">
      <h2>ECONOMIC NEWS</h2>
      <button id="newsRefresh">새로고침</button>
    </div>
    <div class="news-meta">
      마지막 업데이트: <span id="newsUpdated">-</span>
    </div>
    <strong>에프유피글로벌파트너스</strong>
    <div id="news_fup"></div>
    <br/>
    <strong>와이낫글로벌이니셔티브</strong>
    <div id="news_whynot"></div>
  </div>

  <div class="section calendar-box">
    <h2>CALENDAR</h2>
    <div>
      09:00 내부 미팅<br/>
      13:00 외부 미팅<br/>
      16:30 전화 미팅
    </div>
  </div>

</div>

<small>Private · CEO Only</small>

</div>
<script>
/* =====================
   GLOBAL
===================== */
const PIN_CODE = '0925';
const MAIL_API = 'https://script.google.com/macros/s/AKfycbyXlpoE7c6MGH-uZEbwsTzoEVZf_GNBvJ6e-gSRBk_uazd16TIDpgDqS6uamBQ5XAQ/exec';

/* =====================
   PIN UNLOCK (전역)
===================== */
function unlock() {
  const input = document.getElementById('pinInput').value;
  if (input === PIN_CODE) {
    localStorage.setItem('ceo_unlocked', 'true');
    document.getElementById('lockScreen').style.display = 'none';
  } else {
    alert('PIN이 틀렸습니다.');
  }
}

/* =====================
   MAIN
===================== */
document.addEventListener('DOMContentLoaded', () => {

  /* PIN 상태 확인 */
  if (localStorage.getItem('ceo_unlocked') === 'true') {
    document.getElementById('lockScreen').style.display = 'none';
  }

  /* 오늘 날짜 */
  const todayISO = new Date().toISOString().slice(0, 10);
  document.getElementById('today').innerText =
    new Date().toLocaleDateString('ko-KR', {
      year: 'numeric',
      month: '2-digit',
      day: '2-digit',
      weekday: 'short'
    });

  /* =====================
     TODO / CHECK 공통
  ===================== */
  function renderList(key, containerId) {
    const container = document.getElementById(containerId);
    container.innerHTML = '';
    const items = JSON.parse(localStorage.getItem(key) || '[]');

    items.forEach((item, index) => {
      const row = document.createElement('div');
      row.className = 'todo-item';

      const checkbox = document.createElement('input');
      checkbox.type = 'checkbox';
      checkbox.checked = item.done;

      checkbox.onchange = () => {
        items[index].done = checkbox.checked;
        localStorage.setItem(key, JSON.stringify(items));
      };

      const text = document.createElement('span');
      text.textContent = item.text;
      if (item.done) text.style.color = '#aaa';

      const del = document.createElement('span');
      del.textContent = ' ×';
      del.style.cursor = 'pointer';
      del.style.color = '#ccc';
      del.onclick = () => {
        items.splice(index, 1);
        localStorage.setItem(key, JSON.stringify(items));
        renderList(key, containerId);
      };

      row.appendChild(checkbox);
      row.appendChild(text);
      row.appendChild(del);
      container.appendChild(row);
    });
  }

  /* TODAY TASKS */
  const todayKey = 'todayTasks_' + todayISO;
  renderList(todayKey, 'todayTasks');

  document.getElementById('newTodayTask').addEventListener('keypress', e => {
    if (e.key === 'Enter' && e.target.value.trim()) {
      const items = JSON.parse(localStorage.getItem(todayKey) || '[]');
      items.push({ text: e.target.value, done: false });
      localStorage.setItem(todayKey, JSON.stringify(items));
      e.target.value = '';
      renderList(todayKey, 'todayTasks');
    }
  });

  /* CHECK LIST */
  const checkKey = 'checkList';
  renderList(checkKey, 'checkList');

  document.getElementById('newCheckItem').addEventListener('keypress', e => {
    if (e.key === 'Enter' && e.target.value.trim()) {
      const items = JSON.parse(localStorage.getItem(checkKey) || '[]');
      items.push({ text: e.target.value, done: false });
      localStorage.setItem(checkKey, JSON.stringify(items));
      e.target.value = '';
      renderList(checkKey, 'checkList');
    }
  });

  /* YESTERDAY */
  const yesterday = new Date();
  yesterday.setDate(yesterday.getDate() - 1);
  const yesterdayKey = 'todayTasks_' + yesterday.toISOString().slice(0, 10);
  const yesterdayData = JSON.parse(localStorage.getItem(yesterdayKey) || '[]');
  const yBox = document.getElementById('yesterdayTasks');

  yBox.innerHTML = '';
  if (yesterdayData.length === 0) {
    yBox.textContent = '• 기록 없음';
  } else {
    yesterdayData.forEach(item => {
      const row = document.createElement('div');
      row.textContent = '• ' + item.text;
      yBox.appendChild(row);
    });
  }

/* =====================
   MAIL LOAD (ACCOUNT BASED)
===================== */

const MAIL_APIS = {
  gmail_personal: {
    url: 'https://script.google.com/macros/s/AKfycbxPt7-RQromTNCVGjk1KW9UIf9hj6voRQEjJrlmZNy_oA3CHI03apedJWrDCbvpUU9njg/exec',
    target: 'mail_gmail_personal'
  },
  gmail_company: {
    url: 'https://script.google.com/macros/s/AKfycbyXlpoE7c6MGH-uzEBwsTzoEVZf_GNBvJGe-gSRBk_uaZdl6TIDpglDqS6uamBQ5XAQ/exec',
    target: 'mail_gmail_company'
  }
};

function renderMail(api) {
  const box = document.getElementById(api.target);
  box.textContent = '불러오는 중…';

  fetch(api.url)
    .then(res => res.json())
    .then(data => {
      box.innerHTML = '';

      if (!data || data.length === 0) {
        box.textContent = '읽지 않은 메일 없음';
        return;
      }

      data.slice(0, 6).forEach(mail => {
        // 발신자 이름 정리
        const fromName = mail.from.split('<')[0].replace(/"/g, '').trim();

        // 네이버 메일 판별
        const isNaver = mail.from.includes('@naver');
        const naverLabel = isNaver
          ? `<span style="
              font-size:11px;
              color:#fff;
              background:#2DB400;
              padding:2px 6px;
              margin-left:6px;
              border-radius:4px;
            ">NAVER</span>`
          : '';

        // 제목 정리
        const subject =
          mail.subject.length > 36
            ? mail.subject.slice(0, 36) + '…'
            : mail.subject;

        // 행 컨테이너
        const row = document.createElement('div');
        row.style.marginBottom = '8px';

        // 발신자
        const strong = document.createElement('strong');
        strong.innerHTML = fromName + naverLabel;

        // 줄바꿈
        const br = document.createElement('br');

        // 메일 링크
        const link = document.createElement('a');
        link.href = mail.link;
        link.target = '_blank';
        link.style.color = '#555';
        link.style.textDecoration = 'none';
        link.textContent = subject;

        // 조립
        row.appendChild(strong);
        row.appendChild(br);
        row.appendChild(link);

        box.appendChild(row);
      });
    })
    .catch(() => {
      box.textContent = '메일 로드 실패';
    });
}

/* PIN 해제 이후에만 메일 로드 */
if (localStorage.getItem('ceo_unlocked') === 'true') {
  renderMail(MAIL_APIS.gmail_personal);
  renderMail(MAIL_APIS.gmail_company);
    }
});
    // MAIL 접기 / 펼치기
const mailToggleBtn = document.getElementById('mailToggle');
const mailContent = document.getElementById('mailContent');

let mailOpened = true;

if (mailToggleBtn && mailContent) {
  mailToggleBtn.addEventListener('click', () => {
    mailOpened = !mailOpened;
    mailContent.style.display = mailOpened ? 'block' : 'none';
    mailToggleBtn.textContent = mailOpened ? '접기' : '펼치기';
  });
}

// MAIL 새로고침
const mailRefreshBtn = document.getElementById('mailRefresh');

if (mailRefreshBtn) {
  mailRefreshBtn.addEventListener('click', () => {
    renderMail(MAIL_APIS.gmail_personal);
    renderMail(MAIL_APIS.gmail_company);
  });
}
/* =====================
   NEWS API
===================== */

const FUP_NEWS_API =
  'https://api.rss2json.com/v1/api.json?rss_url=' +
  encodeURIComponent(
    'https://news.google.com/rss/search?q=에프유피글로벌파트너스&hl=ko&gl=KR&ceid=KR:ko'
  );

const WHYNOT_NEWS_API =
  'https://api.rss2json.com/v1/api.json?rss_url=' +
  encodeURIComponent(
    'https://news.google.com/rss/search?q=와이낫글로벌이니셔티브&hl=ko&gl=KR&ceid=KR:ko'
  );

/* =====================
   NEWS LOADER
===================== */

function loadNews(apiUrl, targetId) {
  fetch(apiUrl)
    .then(res => res.json())
    .then(data => {
      const container = document.getElementById(targetId);
      container.innerHTML = '';

      if (!data.items || data.items.length === 0) {
        container.innerHTML = '<div>관련 뉴스 없음</div>';
        return;
      }

      data.items.slice(0, 3).forEach(item => {
        const div = document.createElement('div');
        div.style.marginBottom = '6px';

        const a = document.createElement('a');
        a.href = item.link;
        a.target = '_blank';
        a.textContent = item.title.replace(/<[^>]*>/g, '');
        a.style.color = '#111';
        a.style.textDecoration = 'none';

        div.appendChild(a);
        container.appendChild(div);
      });
    })
    .catch(() => {
      document.getElementById(targetId).innerHTML =
        '<div>뉴스 로드 실패</div>';
    });
}

/* =====================
   RUN
===================== */

document.addEventListener('DOMContentLoaded', () => {
  loadNews(FUP_NEWS_API, 'news_fup');
  loadNews(WHYNOT_NEWS_API, 'news_whynot');
});
    function updateNewsTime() {
  const now = new Date();
  const timeText = now.toLocaleTimeString('ko-KR', {
    hour: '2-digit',
    minute: '2-digit'
  });
  document.getElementById('newsUpdated').innerText = timeText;
}

// 최초 로드 시 시간 표시
updateNewsTime();

// 새로고침 버튼
const newsRefreshBtn = document.getElementById('newsRefresh');
if (newsRefreshBtn) {
  newsRefreshBtn.addEventListener('click', () => {
    loadNews(FUP_NEWS_API, 'news_fup');
    loadNews(WHYNOT_NEWS_API, 'news_whynot');
    updateNewsTime();
  });
}
</script>
</body>
</html>
